import{r as c,j as e,a as G,u as K}from"./index-BzgxH7_M.js";import{e as b,d as A}from"./index-BIAQVY8k.js";import{F as O,a as U}from"./index-DAr2yh3w.js";import{B as Q}from"./index-DxjXa1Bi.js";import{g as W,b as Z,c as v,e as ee}from"./companyService-b3vlbPf8.js";import{S as z}from"./index-DQlLYHdx.js";import{e as se,c as te,f as ne}from"./dateTimeFormater-D7Rvvgct.js";import{g as ie}from"./index-DWOAUneP.js";import"./iconBase-2GWgdyYW.js";const ae=({setIsNew:l,setNews:p})=>{const[u,h]=c.useState(null),m=d=>{const{value:n,name:x}=d.target;h({...u,[x]:x==="date"?new Date(new Date(n).setHours(new Date().getHours(),new Date().getMinutes(),new Date().getSeconds())).toISOString():n})},r=()=>{p(d=>[...d,u]),l(!1)};return e.jsx("div",{className:"pop",children:e.jsxs("div",{className:"pop-body col-6",children:[e.jsxs("div",{className:"text-end",children:[" ",e.jsx(Q,{onClick:()=>l(d=>!d),className:"cursor-pointer",size:30})]}),e.jsx("h5",{className:"text-center mb-4 fs-4",children:"Add a news"}),e.jsxs("div",{className:"d-flex flex-column gap-4",children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"",children:"News Title"}),e.jsx("input",{type:"text",name:"name",onChange:m,className:"input-field"})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"",children:"News Link"}),e.jsx("input",{type:"text",name:"link",onChange:m,className:"input-field"})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"",children:"News Date"}),e.jsx("input",{type:"date",name:"date",onChange:m,className:"input-field"})]}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:r,className:"btn-red col-3 rounded-5",children:"Save"})})]})]})})},ce=async(l,p)=>{let u=0;const h=await se(l),m={};return Array.isArray(h)&&h.forEach(r=>{var d;(d=r==null?void 0:r.investors)==null||d.forEach(n=>{const x=n==null?void 0:n.investerId,y=parseInt((n==null?void 0:n.amount)||0),S=parseInt((n==null?void 0:n.fees)||0);x&&(m[x]||(m[x]=0),m[x]+=y+S)})}),u=Object.values(m).reduce((r,d)=>r+(parseInt(p||0)-d||0),0),u===0?p:u},je=()=>{const{state:l}=G(),[p,u]=c.useState(!1),[h,m]=c.useState(!1),[r,d]=c.useState(!1),[n,x]=c.useState(null),[y,S]=c.useState(null),[P,M]=c.useState(null),[o,C]=c.useState(null),[N,D]=c.useState([]),[f,T]=c.useState([]),[j,E]=c.useState([]),[I,V]=c.useState([]),[k,B]=c.useState([]),L=K();c.useEffect(()=>{l&&(async()=>{const t=await W(l);x(t),D(t==null?void 0:t.news),E(t==null?void 0:t.investDoc),T(t==null?void 0:t.update),C(t==null?void 0:t.dealSummary)})()},[l]),c.useEffect(()=>{(async()=>{if(n!=null&&n._id){const{totalInvestment:t,current:i}=await ie(n==null?void 0:n._id),a=await ce(l,(o==null?void 0:o.currentValuation)||0);C({...o,cumulatedInvest:t,profitLoss:a})}})()},[n==null?void 0:n._id]),console.log(o);const g=s=>{try{const{name:t,value:i,files:a}=s.target;x({...n,[t]:a?a[0]:i});const w=a?a[0]:null;t==="cover"&&S(w?URL.createObjectURL(w):null),t==="profile"&&M(w?URL.createObjectURL(w):null)}catch(t){console.log(t)}},_=s=>{const{name:t,value:i}=s.target;C({...o,[t]:i})},H=s=>{var t;try{const{name:i,files:a}=s.target;V([...I,{name:(t=a[0])==null?void 0:t.name,id:f.length}]),T([...f,{[i]:a[0],id:f.length,date:new Date().toLocaleDateString()}])}catch(i){console.log(i)}},J=s=>{var t;try{const{name:i,files:a}=s.target;B([...k,{id:j.length,name:(t=a[0])==null?void 0:t.name}]),E([...j,{[i]:a[0],id:j.length,date:new Date().toLocaleDateString()}])}catch(i){console.log(i)}},X=s=>{E(t=>t.filter(i=>i.id!==s))},Y=s=>{D(t=>t.filter(i=>i.name!==s))},$=s=>{T(t=>t.filter(i=>i.id!==s))},q=async s=>{s.preventDefault();const t=new FormData;for(const[i,a]of Object.entries(n))["dealSummary","news","update","investDoc"].includes(i)||t.append(i,a);if(t.append("dealSummary",JSON.stringify(o)),t.append("news",JSON.stringify(N)),f.forEach(i=>{t.append("update",i.updatedoc)}),j.forEach(i=>{t.append("investDoc",i.investDoc)}),l){await Z(l,t),L(-1);return}await v(t),L(-1)},R=s=>{ee(s)};return e.jsxs("form",{action:"",onSubmit:q,children:[e.jsxs("div",{className:"new-company",children:[e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-9 ps-0",children:e.jsxs("div",{children:[e.jsxs("div",{className:"cover-profile d-flex flex-column",children:[e.jsx("img",{src:y||z+(n==null?void 0:n.cover),className:"position-absolute rounded-3 inset-0 w-100 h-100",alt:"cover"}),e.jsx("input",{onChange:g,name:"cover",id:"cover",type:"file"}),e.jsx("label",{htmlFor:"cover",className:"p-1 px-2 cover-label rounded bg-green text-white",children:e.jsx(b,{size:20})}),e.jsx("div",{className:"mt-auto",children:e.jsxs("div",{className:"profile  ",children:[e.jsx("img",{src:P||z+(n==null?void 0:n.profile),className:"position-absolute w-100 h-100 rounded-circle",style:{inset:"0"},alt:""}),e.jsx("input",{name:"profile",onChange:g,type:"file",id:"profile"}),e.jsx("label",{htmlFor:"profile",className:"p-1 px-2 pro-label rounded bg-green text-white",children:e.jsx(b,{size:20})})]})})]}),e.jsxs("div",{className:"about col-md-9 d-flex bg-white my-3 py-1  border border-2 rounded px-3 justify-content-between align-items-center",children:[e.jsxs("h5",{className:" my-auto",children:[e.jsx("span",{className:"fw-semibold",children:"  ABOUT"}),r?e.jsx("input",{type:"text",name:"name",onChange:g,value:n==null?void 0:n.name,className:"py-2 rounded ms-3"}):e.jsx("span",{className:"text-uppercase ps-2 fw-bold",children:n==null?void 0:n.name})]}),e.jsx("div",{onClick:()=>d(!r),style:{width:"35px",aspectRatio:"1/1"},className:"d-flex align-items-center justify-content-center bg-pink text-white cursor-pointer rounded-circle",children:e.jsx(O,{size:20})})]}),e.jsx("div",{children:e.jsx("textarea",{name:"about",value:n==null?void 0:n.about,style:{cursor:r?"auto":"not-allowed"},disabled:!r,onChange:g,placeholder:`${r?"":"click on edit button."}  `,className:"w-100 border pb-0 bg-white rounded p-3",rows:7,id:""})})]})}),e.jsx("div",{className:"col-3 h-inherit d-flex flex-column mb-2",children:e.jsxs("div",{className:"deal d-flex flex-column h-100",children:[e.jsxs("div",{className:"about d-flex bg-white mb-3 py-1 border border-2 rounded px-2 justify-content-between align-items-center",children:[e.jsx("div",{className:"fw-semibold",children:"DEAL SUMMARY"}),e.jsx("div",{onClick:()=>m(!h),style:{width:"35px",aspectRatio:"1/1"},className:"d-flex  align-items-center justify-content-center bg-pink text-white cursor-pointer rounded-circle",children:e.jsx(O,{size:20})})]}),e.jsx("div",{className:"deal-list px-4  h-100 py-4  rounded bg-white border border-2 d-flex flex-column gap-3 h-100",children:F==null?void 0:F.map((s,t)=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:s==null?void 0:s.name,className:"text-muted small",children:s==null?void 0:s.label}),e.jsx("br",{}),e.jsx("div",{children:h?(s==null?void 0:s.type)==="input"&&e.jsx("input",{name:s==null?void 0:s.name,onChange:_,type:(s==null?void 0:s.name)==="investDate"?"date":"text",placeholder:"-",className:" rounded px-2 w-100"}):o&&o[s==null?void 0:s.name]?e.jsx("span",{className:"fw-semibold",children:re.includes(s==null?void 0:s.name)?te(o[s==null?void 0:s.name]||0):o[s==null?void 0:s.name]}):"-"})]},t))})]})})]}),e.jsxs("div",{className:"row pb-4",children:[e.jsxs("div",{className:"col-md-6 ps-0",children:[e.jsxs("div",{className:" d-flex bg-white my-3 py-2 border border-2 rounded px-3 justify-content-between align-items-center",children:[e.jsx("div",{className:"fw-semibold",children:"Latest News"}),e.jsx("div",{style:{width:"30px",aspectRatio:"1/1"},className:"d-flex align-items-center justify-content-center bg-green text-white cursor-pointer rounded-2",children:e.jsx(b,{onClick:()=>u(!p),size:20})})]}),e.jsx("div",{className:"details bg-white rounded p-3 d-flex flex-column gap-3 ",children:N.length>0&&(N==null?void 0:N.map((s,t)=>e.jsxs("div",{className:"d-flex  flex-column gap-2",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("a",{href:s==null?void 0:s.link,className:"text-dark",target:"_blank",rel:"noopener noreferrer",children:s==null?void 0:s.name}),e.jsx("div",{onClick:()=>Y(s==null?void 0:s.name),className:"ps-3 text-muted",children:e.jsx(A,{className:"cursor-pointer",size:20})})]}),e.jsx("small",{className:"text-muted tracking-normal",children:ne(s==null?void 0:s.date)})]},t)))})]}),e.jsxs("div",{className:"col-md-6  row pe-0",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{children:[e.jsxs("div",{className:" position-relative d-flex bg-white my-3 py-2 border border-2 rounded px-3 justify-content-between align-items-center",children:[e.jsx("div",{className:"fw-semibold",children:"UPDATE"}),e.jsx("input",{type:"file",name:"updatedoc",onChange:H,style:{opacity:"0"},className:"position-absolute"}),e.jsx("label",{htmlFor:"updatedoc",children:e.jsx("div",{style:{width:"30px",aspectRatio:"1/1"},className:"d-flex align-items-center justify-content-center bg-green text-white cursor-pointer rounded-2",children:e.jsx(b,{size:20})})})]}),e.jsx("div",{className:"details bg-white rounded d-flex flex-column gap-3 py-3 ",children:f.length>0&&f.map((s,t)=>{var i;return e.jsxs("div",{className:"d-flex  mx-2 ms-3 gap-2",children:[e.jsx("div",{children:e.jsx(U,{className:"text-muted",size:20})}),e.jsxs("div",{className:"d-flex flex-column gap-1",children:[e.jsx("small",{onClick:()=>R(s==null?void 0:s.originalname),className:"text-muted cursor-pointer",children:(s==null?void 0:s.originalname)||((i=I.find(a=>(a==null?void 0:a.id)===(s==null?void 0:s.id)))==null?void 0:i.name)||"CONTRACT UPDATE"}),e.jsx("small",{className:"fw-bold",children:s==null?void 0:s.date})]}),e.jsx("div",{onClick:()=>$(s==null?void 0:s.id),className:"ps-3 text-muted",children:e.jsx(A,{className:"cursor-pointer",size:20})})]})})})]})}),e.jsx("div",{className:"col-6 pe-0 ps-3",children:e.jsxs("div",{children:[e.jsxs("div",{className:" position-relative d-flex bg-white my-3 py-2 border border-2 rounded px-3 justify-content-between align-items-center",children:[e.jsx("div",{className:"fw-semibold",children:"INVESTMENT DOCS"}),e.jsx("input",{type:"file",name:"investDoc",onChange:J,style:{opacity:"0"},className:"position-absolute"}),e.jsx("label",{htmlFor:"updatedoc",children:e.jsx("div",{style:{width:"30px",aspectRatio:"1/1"},className:"d-flex align-items-center justify-content-center bg-green text-white cursor-pointer rounded-2",children:e.jsx(b,{size:20})})})]}),e.jsx("div",{className:"details bg-white rounded d-flex flex-column gap-3 py-3 ",children:j.length>0&&j.map((s,t)=>{var i;return e.jsxs("div",{className:"d-flex  mx-2 ms-3 gap-2",children:[e.jsx("div",{children:e.jsx(U,{className:"text-muted",size:25})}),e.jsxs("div",{className:"d-flex flex-column gap-1",children:[e.jsx("small",{onClick:()=>R(s==null?void 0:s.originalname),className:"text-muted cursor-pointer",children:(s==null?void 0:s.originalname)||((i=k.find(a=>(a==null?void 0:a.id)===(s==null?void 0:s.id)))==null?void 0:i.name)||"CONTRACT UPDATE"}),e.jsx("small",{className:"fw-bold",children:s==null?void 0:s.date})]}),e.jsx("div",{onClick:()=>X(s==null?void 0:s.id),className:"ps-3 text-muted",children:e.jsx(A,{className:"cursor-pointer",size:20})})]})})})]})})]})]})]}),p&&e.jsx(ae,{setIsNew:u,setNews:D})]}),n&&e.jsx("div",{className:"text-center pb-4 ",children:e.jsx("button",{className:"btn-red w-50",children:"Save"})})]})},F=[{name:"asset",label:"ASSET CLASS",type:"input"},{name:"investDate",label:"INVESTMENT DATE"},{name:"sector",label:"SECTOR",type:"input"},{name:"cumulatedInvest",label:"CUMULATED INVESTMENTS"},{name:"currentValuation",label:"CURRENT VALUATION",type:"input"},{name:"profitLoss",label:"TOTAL PROFIT (LOSS)"}],re=["cumulatedInvest","currentValuation","profitLoss"];export{je as default};
